<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clean HTML Tool</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      background: #f7f7f7;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    textarea, pre {
      width: 100%;
      min-height: 200px;
      padding: 1rem;
      font-family: monospace;
      font-size: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: #fff;
    }
    button {
      background-color: #007acc;
      color: white;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      margin-right: 1rem;
    }
    button:hover {
      background-color: #005fa3;
    }
    .output-container {
      position: relative;
    }
    .copy-button {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #4CAF50;
    }
  </style>
</head>
<body>
  <h1>Clean HTML Tool</h1>
  <textarea id="input" placeholder="Paste your messy HTML or plain text here..."></textarea>
  <br />
  <button onclick="cleanHTML()">Clean HTML</button>

  <div class="output-container">
    <button class="copy-button" onclick="copyOutput()">Copy</button>
    <pre id="output"></pre>
  </div>

  <script>
    const allowedTags = ['P', 'UL', 'LI', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'B', 'I', 'U', 'A'];

    function cleanHTML() {
      const input = document.getElementById('input').value;
      const converted = convertPlainTextToHTML(input);
      const parser = new DOMParser();
      const doc = parser.parseFromString(`<div>${converted}</div>`, 'text/html');
      deepClean(doc.body);
      document.getElementById('output').textContent = formatOutput(doc.body.innerHTML.trim());
    }

    function deepClean(node) {
      const children = Array.from(node.childNodes);
      for (let child of children) {
        if (child.nodeType === 1) {
          if (!allowedTags.includes(child.tagName)) {
            deepClean(child); // clean children before unwrapping
            while (child.firstChild) {
              node.insertBefore(child.firstChild, child);
            }
            node.removeChild(child);
          } else {
            for (let attr of Array.from(child.attributes)) {
              if (child.tagName === 'A' && (attr.name === 'href' || attr.name === 'target')) continue;
              child.removeAttribute(attr.name);
            }
            if (child.tagName === 'A' && (!child.getAttribute('href') || child.getAttribute('href').trim() === '')) {
              const u = document.createElement('u');
              u.innerHTML = child.innerHTML;
              node.replaceChild(u, child);
            } else {
              deepClean(child);
            }
          }
        } else if (child.nodeType === 3) {
          // Text node â€” keep
        } else {
          node.removeChild(child);
        }
      }
    }

    function convertPlainTextToHTML(input) {
      const lines = input.split(/\r?\n/).filter(line => line.trim() !== '');
      let output = '';
      for (let line of lines) {
        const headingMatch = line.match(/^\(h([1-6])\)\s*(.*)$/i);
        if (headingMatch) {
          const level = headingMatch[1];
          const text = headingMatch[2].trim();
          output += `<h${level}>${text}</h${level}>\n`;
        } else {
          output += `<p>${line.trim()}</p>\n`;
        }
      }
      return output;
    }

    function formatOutput(html) {
      return html
        .replace(/>\s+</g, '><') // remove whitespace between tags
        .replace(/(<\/?(?:h[1-6]|p|ul|li|b|i|u|a)[^>]*>)/g, '\n$1') // line breaks
        .replace(/\n+/g, '\n') // clean up double line breaks
        .replace(/^\s+|\s+$/g, '') // trim start/end
    }

    function copyOutput() {
      const text = document.getElementById('output').textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
      });
    }
  </script>
</body>
</html>
